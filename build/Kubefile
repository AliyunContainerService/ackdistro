FROM ackdistro:genesis2

COPY Metadata .

COPY trident ./bin
COPY kubectl ./bin
COPY kubeadm ./bin
COPY kubelet ./bin
COPY helm ./bin

COPY scripts/disk_init.sh scripts
COPY scripts/disk_init_rollback.sh scripts
COPY scripts/install_addons.sh scripts
COPY plugins/disk_init_on_master_shell_plugin.yaml plugins
COPY plugins/disk_init_rollback_on_master_shell_plugin.yaml plugins
COPY plugins/disk_init_rollback_shell_plugin.yaml plugins
COPY plugins/disk_init_shell_plugin.yaml plugins
COPY plugins/preflight_shell_plugin.yaml plugins
COPY plugins/install_addons_shell_plugin.yaml plugins

COPY imageList manifests
COPY kubeadm.yml ./etc
COPY statics/audit-policy.yml ./statics

COPY charts/kube-core chart
COPY charts/hybridnet chart
COPY charts/open-local chart
COPY charts/l-zero chart
COPY charts/l-zero-library chart
COPY charts/calico chart
COPY yamls ack-distro-yamls

CMD helm -n kube-system upgrade -i kube-core chart/kube-core
CMD kubectl create ns acs-system || true
CMD kubectl apply -f ack-distro-yamls/*
