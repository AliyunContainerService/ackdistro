FROM registry.cn-qingdao.aliyuncs.com/sealer-io/ack:genesis

COPY Metadata .

COPY trident ./bin
COPY kubectl ./bin
COPY kubeadm ./bin
COPY kubelet ./bin
COPY helm ./bin

COPY scripts/disk_init.sh scripts
COPY scripts/disk_init_rollback.sh scripts
COPY scripts/install_addons.sh scripts

COPY plugins/disk_init_shell_plugin.yaml plugins
COPY plugins/disk_init_on_master_shell_plugin.yaml plugins
COPY plugins/disk_init_rollback_shell_plugin.yaml plugins
COPY plugins/disk_init_rollback_on_master_shell_plugin.yaml plugins
COPY plugins/preflight_shell_plugin.yaml plugins
COPY plugins/install_addons_shell_plugin.yaml plugins
COPY plugins/health_check_shell_plugin.yaml plugins

COPY imageList manifests
COPY kubeadm.yml ./etc
COPY statics/audit-policy.yml ./statics

COPY charts/kube-core charts
COPY charts/hybridnet charts
COPY charts/open-local charts
COPY charts/l-zero charts
COPY charts/l-zero-library charts
COPY yamls ack-distro-yamls

CMD helm -n kube-system upgrade -i kube-core charts/kube-core
CMD kubectl create ns acs-system || true
CMD kubectl apply -f ack-distro-yamls/*
