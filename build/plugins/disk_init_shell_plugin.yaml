---
apiVersion: sealer.aliyun.com/v1alpha1
kind: Plugin
metadata:
  name: disk-init # Specify this plugin name,will dump in $rootfs/plugin dir.
spec:
  type: SHELL
  action: PreInit|PreJoin # PreInit PreInstall PostInstall
  'on': master
  data: |
    set -e; set -x
    export EtcdDevice=${EtcdDevice}
    export StorageDevice=${StorageDevice}
    export DockerRunDiskSize=${DockerRunDiskSize}
    export KubeletRunDiskSize=${KubeletRunDiskSize}
    export DaemonFileSystem=${DaemonFileSystem}
    export ContainerRuntime=${ContainerRuntime}
    bash scripts/disk_init_v2.sh
    if [ "$ContainerRuntime" == "containerd" ];then
      bash scripts/containerd.sh
    else
      bash scripts/docker.sh
    fi
---
apiVersion: sealer.aliyun.com/v1alpha1
kind: Plugin
metadata:
  name: node_disk-init # Specify this plugin name,will dump in $rootfs/plugin dir.
spec:
  type: SHELL
  action: PreInit|PreJoin # PreInit PreInstall PostInstall
  'on': node
  data: |
    set -e; set -x
    export StorageDevice=${StorageDevice}
    export DockerRunDiskSize=${DockerRunDiskSize}
    export KubeletRunDiskSize=${KubeletRunDiskSize}
    export DaemonFileSystem=${DaemonFileSystem}
    export ContainerRuntime=${ContainerRuntime}
    bash scripts/disk_init_v2.sh
    if [ "$ContainerRuntime" == "containerd" ];then
      bash scripts/containerd.sh
    else
      bash scripts/docker.sh
    fi